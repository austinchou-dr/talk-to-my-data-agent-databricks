From f5a6700c95ac0ead6c5f5d2bc22349aedccfca27 Mon Sep 17 00:00:00 2001
From: Damon Stanley <damonsava@gmail.com>
Date: Mon, 29 Sep 2025 10:19:26 -0700
Subject: [PATCH] tmp: Improvements to sync + debug logging

---
 utils/logging_helper.py |  4 ++--
 utils/rest_api.py       | 27 +++++++++++++++++++++++++--
 2 files changed, 27 insertions(+), 4 deletions(-)

diff --git a/utils/logging_helper.py b/utils/logging_helper.py
index a0efc74..8cae38e 100644
--- a/utils/logging_helper.py
+++ b/utils/logging_helper.py
@@ -17,7 +17,7 @@ from datetime import datetime
 from functools import wraps
 from typing import Any, Callable, Coroutine, ParamSpec, TypeVar
 
-logging.basicConfig(level=logging.INFO)
+logging.basicConfig(level=logging.DEBUG)
 
 
 def get_logger(name: str = "DataAnalystBackend") -> logging.Logger:
@@ -25,7 +25,7 @@ def get_logger(name: str = "DataAnalystBackend") -> logging.Logger:
         "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
     )
     consoleHandle = logging.StreamHandler()
-    consoleHandle.setLevel(logging.INFO)
+    consoleHandle.setLevel(logging.DEBUG)
     consoleHandle.setFormatter(formatter)
     logger = logging.getLogger(name)
     logger.propagate = False  # Prevent propagation to root logger
diff --git a/utils/rest_api.py b/utils/rest_api.py
index 4b0a7a3..74c1f4e 100644
--- a/utils/rest_api.py
+++ b/utils/rest_api.py
@@ -379,7 +379,7 @@ def _set_session_cookie(
 
 
 @router.get("/registry/datasets")
-async def get_registry_datasets(
+def get_registry_datasets(
     request: Request, remote: bool = False, limit: int = 100
 ) -> list[DataRegistryDataset]:
     """Return all registry datasets
@@ -410,8 +410,21 @@ async def process_and_update(
         pass
 
 
+# Making this sync
 @router.post("/datasets/upload")
-async def upload_files(
+def upload_files(
+    request: Request,
+    background_tasks: BackgroundTasks,
+    data_source: str | DataSourceType | None = None,
+    analyst_db: AnalystDB = Depends(get_initialized_db),
+    files: List[UploadFile] | None = None,
+    registry_ids: str | None = Form(None),
+) -> list[FileUploadResponse]:
+    return asyncio.run(_upload_files(
+        request=request, 
+        background_tasks=background_tasks, data_source=data_source, analyst_db=analyst_db, files=files, registry_ids=registry_ids))
+    
+async def _upload_files(
     request: Request,
     background_tasks: BackgroundTasks,
     data_source: str | DataSourceType | None = None,
@@ -560,6 +573,16 @@ async def load_from_database(
     background_tasks: BackgroundTasks,
     analyst_db: AnalystDB = Depends(get_initialized_db),
     sample_size: int = 5000,
+) -> list[str]:
+    return asyncio.run(_load_from_database(
+        data=data, background_tasks=background_tasks, analyst_db=analyst_db, sample_size=sample_size
+    ))
+    
+async def _load_from_database(
+    data: LoadDatabaseRequest,
+    background_tasks: BackgroundTasks,
+    analyst_db: AnalystDB = Depends(get_initialized_db),
+    sample_size: int = 5000,
 ) -> list[str]:
     dataset_names = []
 
-- 
2.51.0

